apply plugin: 'jacoco'

ext {
    coverageSourceDirs = 'src/test/java'
}

jacoco {
    toolVersion = "0.8.6"
    reportsDir = file("$buildDir/reports/rep")
}

task jacocoTestReport(type: JacocoReport) {
    reports {
        xml.enabled = true
        html.enabled = true
    }

    def excludes = ['**/R.class', '**/R$*.class', '**/BuildConfig.*', '**/Manifest*.*',
                    '**/*Test*.*', 'android/**/*.*', '**/*$[0-9].*']

    sourceDirectories.from = files(["$projectDir/src/main/kotlin"])
    classDirectories.from = files([fileTree(dir: "$buildDir/tmp/kotlin-classes/debug", excludes: excludes)])
    executionData.from = fileTree(dir: buildDir, includes: [
            'jacoco/testDebugUnitTest.exec', 'outputs/code_coverage/debugAndroidTest/connected/**/*.ec'
    ])
}